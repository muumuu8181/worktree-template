<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’° ãŠé‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .summary-card.income {
            background: linear-gradient(45deg, #43e97b 0%, #38f9d7 100%);
        }

        .summary-card.expense {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
        }

        .summary-card.balance {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }

        .summary-card:hover {
            transform: translateY(-5px);
        }

        .summary-card h3 {
            font-size: 1.1em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .summary-card .amount {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .input-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .input-section h2 {
            margin-bottom: 20px;
            color: #555;
            font-size: 1.5em;
        }

        .input-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #43e97b, #38f9d7);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #fa709a, #fee140);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .transactions-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .transactions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .transactions-table th,
        .transactions-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .transactions-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }

        .transactions-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .transaction-income {
            color: #43e97b;
            font-weight: bold;
        }

        .transaction-expense {
            color: #fa709a;
            font-weight: bold;
        }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: #ffc107;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .edit-btn:hover, .delete-btn:hover {
            transform: scale(1.1);
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-section select,
        .filter-section input {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 14px;
        }

        .export-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .chart {
            position: relative;
            height: 300px;
            display: flex;
            align-items: end;
            justify-content: space-around;
            background: linear-gradient(to top, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
            border-radius: 10px;
            padding: 20px;
        }

        .chart-bar {
            background: linear-gradient(to top, #667eea, #764ba2);
            width: 40px;
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s ease;
            min-height: 20px;
        }

        .chart-bar:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #555;
        }

        .chart-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: bold;
            color: #333;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .input-form {
                grid-template-columns: 1fr;
            }

            .transactions-table {
                font-size: 14px;
            }

            .transactions-table th,
            .transactions-table td {
                padding: 10px 8px;
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .chart {
                height: 200px;
                padding: 10px;
            }

            .chart-bar {
                width: 25px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-animation {
            animation: success-bounce 0.6s ease-out;
        }

        @keyframes success-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’° ãŠé‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        
        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
        <div class="dashboard">
            <div class="summary-card income">
                <h3>ğŸ“ˆ ç·åå…¥</h3>
                <div class="amount" id="totalIncome">Â¥0</div>
                <div>ä»Šæœˆã®åå…¥</div>
            </div>
            <div class="summary-card expense">
                <h3>ğŸ“‰ ç·æ”¯å‡º</h3>
                <div class="amount" id="totalExpense">Â¥0</div>
                <div>ä»Šæœˆã®æ”¯å‡º</div>
            </div>
            <div class="summary-card balance">
                <h3>ğŸ’³ æ®‹é«˜</h3>
                <div class="amount" id="balance">Â¥0</div>
                <div>ç¾åœ¨ã®æ®‹é«˜</div>
            </div>
        </div>

        <!-- ãƒãƒ£ãƒ¼ãƒˆ -->
        <div class="chart-container">
            <h2>ğŸ“Š æœˆåˆ¥åæ”¯æ¨ç§»</h2>
            <div class="chart" id="monthlyChart">
                <!-- ãƒãƒ£ãƒ¼ãƒˆãƒãƒ¼ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="input-section">
            <h2>ğŸ’¸ æ–°ã—ã„å–å¼•ã‚’è¿½åŠ </h2>
            <form class="input-form" id="transactionForm">
                <div class="form-group">
                    <label for="type">ã‚¿ã‚¤ãƒ—</label>
                    <select id="type" name="type" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="income">åå…¥</option>
                        <option value="expense">æ”¯å‡º</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">é‡‘é¡ï¼ˆå††ï¼‰</label>
                    <input type="number" id="amount" name="amount" min="1" required placeholder="ä¾‹: 50000">
                </div>
                <div class="form-group">
                    <label for="category">ã‚«ãƒ†ã‚´ãƒª</label>
                    <select id="category" name="category" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <!-- ã‚«ãƒ†ã‚´ãƒªã¯JavaScriptã§å‹•çš„ã«æ›´æ–° -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="date">æ—¥ä»˜</label>
                    <input type="date" id="date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="description">èª¬æ˜</label>
                    <textarea id="description" name="description" rows="2" placeholder="å–å¼•ã®è©³ç´°ã‚’å…¥åŠ›ï¼ˆä»»æ„ï¼‰"></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ è¿½åŠ ã™ã‚‹</button>
                </div>
            </form>
        </div>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»æ¤œç´¢ -->
        <div class="transactions-section">
            <div class="transactions-header">
                <h2>ğŸ“‹ å–å¼•å±¥æ­´</h2>
                <div class="filter-section">
                    <select id="filterType">
                        <option value="">å…¨ã¦</option>
                        <option value="income">åå…¥ã®ã¿</option>
                        <option value="expense">æ”¯å‡ºã®ã¿</option>
                    </select>
                    <select id="filterCategory">
                        <option value="">å…¨ã‚«ãƒ†ã‚´ãƒª</option>
                    </select>
                    <input type="text" id="searchText" placeholder="æ¤œç´¢...">
                    <input type="month" id="filterMonth" title="æœˆã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼">
                </div>
            </div>
            
            <!-- å–å¼•ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>æ—¥ä»˜</th>
                        <th>ã‚¿ã‚¤ãƒ—</th>
                        <th>ã‚«ãƒ†ã‚´ãƒª</th>
                        <th>é‡‘é¡</th>
                        <th>èª¬æ˜</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="transactionsTable">
                    <!-- å–å¼•ãƒ‡ãƒ¼ã‚¿ãŒå‹•çš„ã«æŒ¿å…¥ã•ã‚Œã‚‹ -->
                </tbody>
            </table>
        </div>

        <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
        <div class="export-section">
            <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h2>
            <p>å–å¼•ãƒ‡ãƒ¼ã‚¿ã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™</p>
            <br>
            <button class="btn btn-success" onclick="exportToCSV()">ğŸ“Š CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            <button class="btn btn-primary" onclick="exportToJSON()">ğŸ“„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ</button>
            <button class="btn btn-danger" onclick="importFromJSON()">ğŸ“‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾©å…ƒ</button>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>âœï¸ å–å¼•ã‚’ç·¨é›†</h2>
            <form id="editForm">
                <div class="form-group">
                    <label for="editType">ã‚¿ã‚¤ãƒ—</label>
                    <select id="editType" required>
                        <option value="income">åå…¥</option>
                        <option value="expense">æ”¯å‡º</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editAmount">é‡‘é¡ï¼ˆå††ï¼‰</label>
                    <input type="number" id="editAmount" min="1" required>
                </div>
                <div class="form-group">
                    <label for="editCategory">ã‚«ãƒ†ã‚´ãƒª</label>
                    <select id="editCategory" required>
                        <!-- ã‚«ãƒ†ã‚´ãƒªãŒå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDate">æ—¥ä»˜</label>
                    <input type="date" id="editDate" required>
                </div>
                <div class="form-group">
                    <label for="editDescription">èª¬æ˜</label>
                    <textarea id="editDescription" rows="2"></textarea>
                </div>
                <br>
                <button type="submit" class="btn btn-primary">ğŸ’¾ æ›´æ–°ã™ã‚‹</button>
                <button type="button" class="btn btn-danger" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </form>
        </div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>å‡¦ç†ä¸­...</p>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script>
        // ãŠé‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®é«˜åº¦ãªå®Ÿè£…
        class MoneyManager {
            constructor() {
                this.transactions = this.loadFromStorage();
                this.editingId = null;
                
                // ã‚«ãƒ†ã‚´ãƒªå®šç¾©
                this.categories = {
                    income: ['çµ¦ä¸', 'ãƒœãƒ¼ãƒŠã‚¹', 'å‰¯æ¥­', 'æŠ•è³‡åç›Š', 'ãã®ä»–åå…¥'],
                    expense: ['é£Ÿè²»', 'ä½å±…è²»', 'å…‰ç†±è²»', 'é€šä¿¡è²»', 'äº¤é€šè²»', 'åŒ»ç™‚è²»', 'å¨¯æ¥½è²»', 'è¡£æœè²»', 'æ•™è‚²è²»', 'ãã®ä»–æ”¯å‡º']
                };
                
                this.initializeApp();
                this.setupEventListeners();
                this.updateDisplay();
                this.generateChart();
                
                // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®š
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
            }
            
            initializeApp() {
                this.updateCategoryOptions();
                this.updateFilterCategories();
                console.log('ğŸ’° ãŠé‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            }
            
            setupEventListeners() {
                // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
                document.getElementById('transactionForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTransaction();
                });
                
                // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
                document.getElementById('editForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateTransaction();
                });
                
                // ã‚¿ã‚¤ãƒ—å¤‰æ›´æ™‚ã®ã‚«ãƒ†ã‚´ãƒªæ›´æ–°
                document.getElementById('type').addEventListener('change', () => {
                    this.updateCategoryOptions();
                });
                
                document.getElementById('editType').addEventListener('change', () => {
                    this.updateEditCategoryOptions();
                });
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢é€£
                document.getElementById('filterType').addEventListener('change', () => this.filterTransactions());
                document.getElementById('filterCategory').addEventListener('change', () => this.filterTransactions());
                document.getElementById('searchText').addEventListener('input', () => this.filterTransactions());
                document.getElementById('filterMonth').addEventListener('change', () => this.filterTransactions());
                
                // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        this.exportToCSV();
                    }
                });
            }
            
            addTransaction() {
                const formData = new FormData(document.getElementById('transactionForm'));
                const transaction = {
                    id: this.generateId(),
                    type: formData.get('type'),
                    amount: parseFloat(formData.get('amount')),
                    category: formData.get('category'),
                    date: formData.get('date'),
                    description: formData.get('description') || '',
                    timestamp: new Date().toISOString()
                };
                
                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (!this.validateTransaction(transaction)) {
                    return;
                }
                
                this.showLoading();
                
                setTimeout(() => {
                    this.transactions.unshift(transaction);
                    this.saveToStorage();
                    this.updateDisplay();
                    this.generateChart();
                    document.getElementById('transactionForm').reset();
                    document.getElementById('date').value = new Date().toISOString().split('T')[0];
                    
                    this.hideLoading();
                    this.showSuccessAnimation();
                    console.log('âœ… å–å¼•è¿½åŠ å®Œäº†:', transaction);
                }, 500);
            }
            
            editTransaction(id) {
                const transaction = this.transactions.find(t => t.id === id);
                if (!transaction) return;
                
                this.editingId = id;
                document.getElementById('editType').value = transaction.type;
                document.getElementById('editAmount').value = transaction.amount;
                document.getElementById('editDate').value = transaction.date;
                document.getElementById('editDescription').value = transaction.description;
                
                this.updateEditCategoryOptions();
                document.getElementById('editCategory').value = transaction.category;
                
                document.getElementById('editModal').style.display = 'block';
            }
            
            updateTransaction() {
                if (!this.editingId) return;
                
                const transaction = this.transactions.find(t => t.id === this.editingId);
                if (!transaction) return;
                
                transaction.type = document.getElementById('editType').value;
                transaction.amount = parseFloat(document.getElementById('editAmount').value);
                transaction.category = document.getElementById('editCategory').value;
                transaction.date = document.getElementById('editDate').value;
                transaction.description = document.getElementById('editDescription').value;
                transaction.updatedAt = new Date().toISOString();
                
                this.saveToStorage();
                this.updateDisplay();
                this.generateChart();
                this.closeEditModal();
                
                console.log('âœ… å–å¼•æ›´æ–°å®Œäº†:', transaction);
            }
            
            deleteTransaction(id) {
                if (confirm('ã“ã®å–å¼•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.transactions = this.transactions.filter(t => t.id !== id);
                    this.saveToStorage();
                    this.updateDisplay();
                    this.generateChart();
                    console.log('ğŸ—‘ï¸ å–å¼•å‰Šé™¤å®Œäº†:', id);
                }
            }
            
            closeEditModal() {
                document.getElementById('editModal').style.display = 'none';
                this.editingId = null;
            }
            
            updateDisplay() {
                this.updateSummary();
                this.renderTransactions();
            }
            
            updateSummary() {
                const currentMonth = new Date().toISOString().substring(0, 7);
                const monthlyTransactions = this.transactions.filter(t => 
                    t.date.substring(0, 7) === currentMonth
                );
                
                const totalIncome = monthlyTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const totalExpense = monthlyTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const balance = totalIncome - totalExpense;
                
                document.getElementById('totalIncome').textContent = this.formatCurrency(totalIncome);
                document.getElementById('totalExpense').textContent = this.formatCurrency(totalExpense);
                document.getElementById('balance').textContent = this.formatCurrency(balance);
                
                // æ®‹é«˜ã®è‰²ã‚’å¤‰æ›´
                const balanceElement = document.getElementById('balance');
                const balanceCard = balanceElement.closest('.summary-card');
                if (balance >= 0) {
                    balanceCard.style.background = 'linear-gradient(45deg, #43e97b 0%, #38f9d7 100%)';
                } else {
                    balanceCard.style.background = 'linear-gradient(45deg, #fa709a 0%, #fee140 100%)';
                }
            }
            
            renderTransactions() {
                const tbody = document.getElementById('transactionsTable');
                tbody.innerHTML = '';
                
                const filteredTransactions = this.getFilteredTransactions();
                
                if (filteredTransactions.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                                ğŸ“ å–å¼•ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                filteredTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    const amountClass = transaction.type === 'income' ? 'transaction-income' : 'transaction-expense';
                    const amountPrefix = transaction.type === 'income' ? '+' : '-';
                    
                    row.innerHTML = `
                        <td>${this.formatDate(transaction.date)}</td>
                        <td>${transaction.type === 'income' ? 'ğŸ“ˆ åå…¥' : 'ğŸ“‰ æ”¯å‡º'}</td>
                        <td>${transaction.category}</td>
                        <td class="${amountClass}">${amountPrefix}${this.formatCurrency(transaction.amount)}</td>
                        <td>${transaction.description}</td>
                        <td>
                            <button class="edit-btn" onclick="moneyManager.editTransaction('${transaction.id}')">
                                âœï¸ ç·¨é›†
                            </button>
                            <button class="delete-btn" onclick="moneyManager.deleteTransaction('${transaction.id}')">
                                ğŸ—‘ï¸ å‰Šé™¤
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            }
            
            getFilteredTransactions() {
                let filtered = [...this.transactions];
                
                // ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                const typeFilter = document.getElementById('filterType').value;
                if (typeFilter) {
                    filtered = filtered.filter(t => t.type === typeFilter);
                }
                
                // ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                const categoryFilter = document.getElementById('filterCategory').value;
                if (categoryFilter) {
                    filtered = filtered.filter(t => t.category === categoryFilter);
                }
                
                // ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢
                const searchText = document.getElementById('searchText').value.toLowerCase();
                if (searchText) {
                    filtered = filtered.filter(t => 
                        t.description.toLowerCase().includes(searchText) ||
                        t.category.toLowerCase().includes(searchText)
                    );
                }
                
                // æœˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                const monthFilter = document.getElementById('filterMonth').value;
                if (monthFilter) {
                    filtered = filtered.filter(t => t.date.substring(0, 7) === monthFilter);
                }
                
                return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            }
            
            filterTransactions() {
                this.renderTransactions();
            }
            
            updateCategoryOptions() {
                const type = document.getElementById('type').value;
                const categorySelect = document.getElementById('category');
                
                categorySelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
                
                if (type && this.categories[type]) {
                    this.categories[type].forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                }
            }
            
            updateEditCategoryOptions() {
                const type = document.getElementById('editType').value;
                const categorySelect = document.getElementById('editCategory');
                
                categorySelect.innerHTML = '';
                
                if (type && this.categories[type]) {
                    this.categories[type].forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                }
            }
            
            updateFilterCategories() {
                const categoryFilter = document.getElementById('filterCategory');
                const allCategories = [...this.categories.income, ...this.categories.expense];
                
                categoryFilter.innerHTML = '<option value="">å…¨ã‚«ãƒ†ã‚´ãƒª</option>';
                
                allCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
            }
            
            generateChart() {
                const chartContainer = document.getElementById('monthlyChart');
                chartContainer.innerHTML = '';
                
                // éå»6ãƒ¶æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const months = [];
                const now = new Date();
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const monthStr = date.toISOString().substring(0, 7);
                    months.push({
                        key: monthStr,
                        label: `${date.getMonth() + 1}æœˆ`,
                        income: 0,
                        expense: 0
                    });
                }
                
                // å„æœˆã®åæ”¯ã‚’è¨ˆç®—
                this.transactions.forEach(transaction => {
                    const month = months.find(m => m.key === transaction.date.substring(0, 7));
                    if (month) {
                        if (transaction.type === 'income') {
                            month.income += transaction.amount;
                        } else {
                            month.expense += transaction.amount;
                        }
                    }
                });
                
                // æœ€å¤§å€¤ã‚’å–å¾—ï¼ˆãƒãƒ£ãƒ¼ãƒˆã®é«˜ã•èª¿æ•´ç”¨ï¼‰
                const maxAmount = Math.max(...months.map(m => Math.max(m.income, m.expense)));
                
                months.forEach(month => {
                    const monthGroup = document.createElement('div');
                    monthGroup.style.display = 'flex';
                    monthGroup.style.flexDirection = 'column';
                    monthGroup.style.alignItems = 'center';
                    monthGroup.style.position = 'relative';
                    
                    // åå…¥ãƒãƒ¼
                    const incomeBar = document.createElement('div');
                    incomeBar.className = 'chart-bar';
                    incomeBar.style.background = 'linear-gradient(to top, #43e97b, #38f9d7)';
                    incomeBar.style.height = maxAmount > 0 ? `${(month.income / maxAmount) * 200}px` : '20px';
                    incomeBar.style.marginRight = '5px';
                    
                    const incomeValue = document.createElement('div');
                    incomeValue.className = 'chart-value';
                    incomeValue.textContent = this.formatCurrency(month.income);
                    incomeValue.style.color = '#43e97b';
                    incomeBar.appendChild(incomeValue);
                    
                    // æ”¯å‡ºãƒãƒ¼
                    const expenseBar = document.createElement('div');
                    expenseBar.className = 'chart-bar';
                    expenseBar.style.background = 'linear-gradient(to top, #fa709a, #fee140)';
                    expenseBar.style.height = maxAmount > 0 ? `${(month.expense / maxAmount) * 200}px` : '20px';
                    expenseBar.style.marginLeft = '5px';
                    
                    const expenseValue = document.createElement('div');
                    expenseValue.className = 'chart-value';
                    expenseValue.textContent = this.formatCurrency(month.expense);
                    expenseValue.style.color = '#fa709a';
                    expenseBar.appendChild(expenseValue);
                    
                    // ãƒ©ãƒ™ãƒ«
                    const label = document.createElement('div');
                    label.className = 'chart-label';
                    label.textContent = month.label;
                    
                    const barsContainer = document.createElement('div');
                    barsContainer.style.display = 'flex';
                    barsContainer.style.alignItems = 'end';
                    barsContainer.appendChild(incomeBar);
                    barsContainer.appendChild(expenseBar);
                    
                    monthGroup.appendChild(barsContainer);
                    monthGroup.appendChild(label);
                    
                    chartContainer.appendChild(monthGroup);
                });
            }
            
            exportToCSV() {
                const headers = ['æ—¥ä»˜', 'ã‚¿ã‚¤ãƒ—', 'ã‚«ãƒ†ã‚´ãƒª', 'é‡‘é¡', 'èª¬æ˜'];
                const csvContent = [
                    headers.join(','),
                    ...this.transactions.map(t => [
                        t.date,
                        t.type === 'income' ? 'åå…¥' : 'æ”¯å‡º',
                        t.category,
                        t.amount,
                        `"${t.description.replace(/"/g, '""')}"`
                    ].join(','))
                ].join('\n');
                
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `money_management_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                console.log('ğŸ“Š CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');
            }
            
            exportToJSON() {
                const data = {
                    exportDate: new Date().toISOString(),
                    version: '1.0',
                    transactions: this.transactions
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `money_management_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                console.log('ğŸ’¾ JSON ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†');
            }
            
            importFromJSON() {
                document.getElementById('importFile').click();
            }
            
            handleFileImport(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.transactions && Array.isArray(data.transactions)) {
                            if (confirm('æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ãæ›ãˆã¾ã™ã‹ï¼Ÿï¼ˆç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã¾ã™ï¼‰')) {
                                this.transactions = data.transactions;
                                this.saveToStorage();
                                this.updateDisplay();
                                this.generateChart();
                                alert('âœ… ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸ');
                                console.log('ğŸ“‚ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒå®Œäº†');
                            }
                        } else {
                            alert('âŒ ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
                        }
                    } catch (error) {
                        alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        console.error('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    }
                };
                reader.readAsText(file);
            }
            
            validateTransaction(transaction) {
                if (!transaction.type || !transaction.amount || !transaction.category || !transaction.date) {
                    alert('âŒ å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return false;
                }
                
                if (transaction.amount <= 0) {
                    alert('âŒ é‡‘é¡ã¯1å††ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return false;
                }
                
                return true;
            }
            
            generateId() {
                return 'txn_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            formatCurrency(amount) {
                return new Intl.NumberFormat('ja-JP', {
                    style: 'currency',
                    currency: 'JPY'
                }).format(amount);
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ja-JP', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            }
            
            saveToStorage() {
                try {
                    localStorage.setItem('moneyManagerData', JSON.stringify(this.transactions));
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    alert('âš ï¸ ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            
            loadFromStorage() {
                try {
                    const data = localStorage.getItem('moneyManagerData');
                    return data ? JSON.parse(data) : [];
                } catch (error) {
                    console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    return [];
                }
            }
            
            showLoading() {
                document.getElementById('loading').style.display = 'block';
            }
            
            hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }
            
            showSuccessAnimation() {
                document.querySelector('.container').classList.add('success-animation');
                setTimeout(() => {
                    document.querySelector('.container').classList.remove('success-animation');
                }, 600);
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
        let moneyManager;
        
        document.addEventListener('DOMContentLoaded', function() {
            moneyManager = new MoneyManager();
        });
        
        function exportToCSV() {
            moneyManager.exportToCSV();
        }
        
        function exportToJSON() {
            moneyManager.exportToJSON();
        }
        
        function importFromJSON() {
            moneyManager.importFromJSON();
        }
        
        function closeEditModal() {
            moneyManager.closeEditModal();
        }
        
        function handleFileImport(event) {
            moneyManager.handleFileImport(event);
        }
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
        window.addEventListener('resize', function() {
            if (moneyManager) {
                moneyManager.generateChart();
            }
        });
        
        // PWAå¯¾å¿œã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ²ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                console.log('ğŸ’° ãŠé‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - PWAå¯¾å¿œæº–å‚™å®Œäº†');
            });
        }
        
        console.log('ğŸ’° ãŠé‡‘ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
    </script>
</body>
</html>